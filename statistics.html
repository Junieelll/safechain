<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Functional CRUD Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://unicons.iconscout.com/release/v4.0.8/css/line.css"
    />
    <link rel="stylesheet" href="css/dashboard.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/page-load-animation.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      tailwind.config = {
        darkMode: ["class", '[data-theme="dark"]'],
      };
    </script>
  </head>
  <body class="min-h-screen flex transition-all duration-300 dark:bg-neutral-900">
     <aside
      id="sidebar"
      class="fixed w-[270px] m-4 rounded-[20px] sidebar-gradient h-[calc(100vh-32px)] transition-all duration-500 ease-in-out shadow-[0_10px_40px_rgba(0,0,0,0.3)] z-50"
    >
      <header class="flex relative p-5 items-center justify-between">
        <a href="#" class="flex items-center gap-3 no-underline text-white">
          <div
            class="w-[46px] h-[46px] bg-white/20 rounded-full flex items-center justify-center backdrop-blur-[10px] border border-white/30"
          >
            <i class="uil uil-shield-check"></i>
          </div>
          <span
            id="logoText"
            class="text-lg font-semibold whitespace-nowrap transition-opacity duration-300"
            >SafeChain</span
          >
        </a>
        <button
          id="sidebarToggler"
          class="h-[35px] w-[35px] text-white cursor-pointer flex bg-white/20 backdrop-blur-[10px] border border-white/30 items-center justify-center rounded-[10px] transition-all duration-400 shadow-[0_2px_8px_rgba(0,0,0,0.1)] absolute right-5 hover:bg-white/50"
        >
          <i
            class="uil uil-angle-left text-[1.75rem] transition-all duration-400"
          ></i>
        </button>
      </header>

      <nav class="h-[calc(100%-86px)] flex flex-col justify-between">
        <ul
          id="primaryNav"
          class="list-none flex gap-1.5 px-[15px] flex-col translate-y-[15px] transition-all duration-500 ease-in-out"
        >
          <li class="relative nav-item text-sm">
            <a
              href="index.html"
              class="nav-link text-white/85 flex gap-3.5 whitespace-nowrap rounded-xl py-3 px-3.5 items-center border border-transparent transition-all duration-200 ease-in-out hover:text-white hover:bg-white/15"
            >
              <i class="nav-icon uil uil-apps text-xl"></i>
              <span class="nav-label">Dashboard</span>
            </a>
            <span
              class="nav-tooltip py-2 px-3.5 rounded-xl whitespace-nowrap bg-white shadow-[0_4px_15px_rgba(0,0,0,0.2)] font-medium text-sm text-[#01AF78] z-[9999]"
              >Dashboard</span
            >
          </li>
          <li class="relative nav-item text-sm">
            <a
              href="incident.html"
              class="nav-link text-white/85 flex gap-3.5 whitespace-nowrap rounded-xl py-3 px-3.5 items-center border border-transparent transition-all duration-200 ease-in-out hover:text-white hover:bg-white/15"
            >
              <i class="nav-icon uil uil-file-alt text-xl"></i>
              <span class="nav-label">Incident Log</span>
            </a>
            <span
              class="nav-tooltip py-2 px-3.5 rounded-xl whitespace-nowrap bg-white shadow-[0_4px_15px_rgba(0,0,0,0.2)] font-medium text-sm text-[#01AF78] z-[9999]"
              >Incident Log</span
            >
          </li>
          <li class="relative nav-item text-sm">
            <a
              href="resident.html"
              class="nav-link text-white/85 flex gap-3.5 whitespace-nowrap rounded-xl py-3 px-3.5 items-center border border-transparent transition-all duration-200 ease-in-out hover:text-white hover:bg-white/15"
            >
              <i class="nav-icon uil uil-users-alt text-xl"></i>
              <span class="nav-label">Residents</span>
            </a>
            <span
              class="nav-tooltip py-2 px-3.5 rounded-xl whitespace-nowrap bg-white shadow-[0_4px_15px_rgba(0,0,0,0.2)] font-medium text-sm text-[#01AF78] z-[9999]"
              >Residents</span
            >
          </li>
          <li class="relative nav-item text-sm">
            <a
              href="devices.html"
              class="nav-link text-white/85 flex gap-3.5 whitespace-nowrap rounded-xl py-3 px-3.5 items-center border border-transparent transition-all duration-200 ease-in-out hover:text-white hover:bg-white/15"
            >
              <i class="nav-icon uil uil-mobile-android text-xl"></i>
              <span class="nav-label">Devices</span>
            </a>
            <span
              class="nav-tooltip py-2 px-3.5 rounded-xl whitespace-nowrap bg-white shadow-[0_4px_15px_rgba(0,0,0,0.2)] font-medium text-sm text-[#01AF78] z-[9999]"
              >Devices</span
            >
          </li>
          <li class="relative nav-item text-sm">
            <a
              href="statistics.html"
              class="nav-link text-white/85 flex gap-3.5 whitespace-nowrap rounded-xl py-3 px-3.5 items-center border border-transparent transition-all duration-200 ease-in-out hover:text-white hover:bg-white/15 active"
            >
              <i class="nav-icon uil uil-chart-bar text-xl"></i>
              <span class="nav-label">Statistics</span>
            </a>
            <span
              class="nav-tooltip py-2 px-3.5 rounded-xl whitespace-nowrap bg-white shadow-[0_4px_15px_rgba(0,0,0,0.2)] font-medium text-sm text-[#01AF78] z-[9999]"
              >Statistics</span
            >
          </li>
          <li class="relative nav-item text-sm">
            <a
              href="archive.html"
              class="nav-link text-white/85 flex gap-3.5 whitespace-nowrap rounded-xl py-3 px-3.5 items-center border border-transparent transition-all duration-200 ease-in-out hover:text-white hover:bg-white/15"
            >
              <i class="nav-icon uil uil-archive-alt text-2xl"></i>
              <span class="nav-label">Archive</span>
            </a>
            <span
              class="nav-tooltip py-2 px-3.5 rounded-xl whitespace-nowrap bg-white shadow-[0_4px_15px_rgba(0,0,0,0.2)] font-medium text-sm text-[#01AF78] z-[9999]"
              >Archive</span
            >
          </li>
        </ul>

        <ul class="list-none flex gap-1.5 px-[15px] flex-col relative pb-5">
          <li class="relative mb-2.5 nav-item text-sm">
            <a
              href="#"
              id="darkModeToggle"
              class="nav-link text-white/85 flex gap-3.5 whitespace-nowrap rounded-xl py-3 px-3.5 items-center no-underline border border-transparent transition-all duration-200 ease-in-out hover:text-white hover:bg-white/15"
            >
              <i id="darkModeIcon" class="nav-icon uil uil-moon text-xl"></i>
              <span id="darkModeLabel" class="nav-label">Dark Mode</span>
            </a>
            <span
              class="nav-tooltip py-2 px-3.5 rounded-xl whitespace-nowrap bg-white shadow-[0_4px_15px_rgba(0,0,0,0.2)] font-medium text-sm text-[#01AF78] z-[9999]"
              >Dark Mode</span
            >
          </li>
          <li class="relative">
            <button
              id="userProfileBtn"
              class="w-full flex items-center gap-3 py-3 px-3.5 mb-0 rounded-xl text-white no-underline transition-all duration-300 hover:bg-white/15 border-0 cursor-pointer bg-transparent"
            >
              <div
                class="w-[38px] h-[38px] rounded-full avatar-gradient flex items-center justify-center flex-shrink-0 font-semibold text-[0.95rem] border-2 border-white/30"
              >
                JD
              </div>
              <div
                id="userInfo"
                class="flex flex-col transition-opacity duration-300 text-left"
              >
                <span class="font-semibold text-[0.95rem]">John Doe</span>
                <span class="text-xs opacity-80">user@email.example</span>
              </div>
            </button>

            <div
              id="userDropdown"
              class="hidden absolute bottom-full left-0 mb-2 w-[240px] bg-white rounded-xl shadow-[0_4px_20px_rgba(0,0,0,0.25)] overflow-hidden z-[9999]"
            >
              <a
                href="#"
                class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors duration-200 no-underline"
              >
                <i class="uil uil-user text-xl text-[#01AF78]"></i>
                <span class="text-sm font-medium">My Profile</span>
              </a>
              <a
                href="#"
                class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors duration-200 no-underline"
              >
                <i class="uil uil-setting text-xl text-[#01AF78]"></i>
                <span class="text-sm font-medium">Settings</span>
              </a>
              <a
                href="#"
                class="flex items-center gap-3 px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors duration-200 no-underline"
              >
                <i class="uil uil-question-circle text-xl text-[#01AF78]"></i>
                <span class="text-sm font-medium">Help & Support</span>
              </a>
              <div class="border-t border-gray-200"></div>
              <a
                href="#"
                class="flex items-center gap-3 px-4 py-3 text-red-600 hover:bg-red-50 transition-colors duration-200 no-underline"
              >
                <i class="uil uil-signout text-xl"></i>
                <span class="text-sm font-medium">Logout</span>
              </a>
            </div>
          </li>
        </ul>
      </nav>
    </aside>
    <div
      class="main-content flex-grow transition-all duration-500 ease-in-out pl-[300px] pr-8 pt-8 pb-8"
      id="content"
    >
      <div class="flex items-center justify-between mb-6">
        <div class="title">
          <h4 class="text-xl font-semibold text-[#4b4b4b] dark:text-neutral-300">Analytics & Reports</h4>
          <p class="text-sm text-neutral-500 dark:text-neutral-400">Unified view of incidents, response times, and system performance</p>
        </div>
        <div class="actions flex gap-4">
          <button id="filterBtn" class="px-4 py-2 border border-gray-300 dark:border-neutral-600 text-xs text-gray-600 dark:text-neutral-300 font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors">
            <i class="uil uil-filter text-lg"></i>Filters
          </button>
          <button id="exportBtn" class="px-4 py-2 bg-[#01AF78] text-white text-xs font-medium rounded-lg hover:bg-[#019c6e] flex items-center gap-2 shadow-lg shadow-[#01AF78]/40 transition-colors">
            <i class="uil uil-export text-lg"></i>Export Report
          </button>
          <button id="addIncidentBtn" class="px-4 py-2 bg-blue-500 text-white text-xs font-medium rounded-lg hover:bg-blue-600 flex items-center gap-2 shadow-lg shadow-blue-500/40 transition-colors">
            <i class="uil uil-plus text-lg"></i>New Incident
          </button>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card bg-white dark:bg-neutral-800 rounded-2xl p-6 flex items-center gap-4 shadow-sm"><div class="icon p-3 rounded-2xl bg-red-100 w-12 h-12 flex items-center justify-center dark:bg-red-900/40"><i class="uil uil-exclamation-circle text-red-400 dark:text-red-300 text-2xl"></i></div><div class="flex-grow"><p class="text-3xl font-semibold text-neutral-600 dark:text-neutral-300">247</p><p class="text-sm text-neutral-500 dark:text-neutral-400">Total Incidents (30 days)</p></div><span class="text-xs text-red-500 flex items-center gap-1"><i class="uil uil-arrow-up text-sm"></i> 12%</span></div>
        <div class="card bg-white dark:bg-neutral-800 rounded-2xl p-6 flex items-center gap-4 shadow-sm"><div class="icon p-3 rounded-2xl bg-blue-100 w-12 h-12 flex items-center justify-center dark:bg-blue-900/40"><i class="uil uil-clock-three text-blue-400 dark:text-blue-300 text-2xl"></i></div><div class="flex-grow"><p class="text-3xl font-semibold text-neutral-600 dark:text-neutral-300">2.4 min</p><p class="text-sm text-neutral-500 dark:text-neutral-400">Avg Response Time</p></div><span class="text-xs text-red-500 flex items-center gap-1"><i class="uil uil-arrow-up text-sm"></i> 12%</span></div>
        <div class="card bg-white dark:bg-neutral-800 rounded-2xl p-6 flex items-center gap-4 shadow-sm"><div class="icon p-3 rounded-2xl bg-emerald-100 w-12 h-12 flex items-center justify-center dark:bg-emerald-900/40"><i class="uil uil-check-circle text-emerald-400 dark:text-emerald-300 text-2xl"></i></div><div class="flex-grow"><p class="text-3xl font-semibold text-neutral-600 dark:text-neutral-300">98.3%</p><p class="text-sm text-neutral-500 dark:text-neutral-400">Resolution Rate</p></div><span class="text-xs text-red-500 flex items-center gap-1"><i class="uil uil-arrow-up text-sm"></i> 12%</span></div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-sm col-span-1 lg:col-span-2"><h5 class="text-sm font-semibold text-gray-700 dark:text-neutral-300 mb-4">Incident Trends</h5><p class="text-xs text-neutral-500 dark:text-neutral-400 mb-4">Daily reports over 30 days</p><div style="height: 200px"><canvas id="incidentTrendsChart"></canvas></div></div>
        <div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-sm col-span-1"><h5 class="text-sm font-semibold text-gray-700 dark:text-neutral-300 mb-4">Incident Types</h5><p class="text-xs text-neutral-500 dark:text-neutral-400 mb-4">Distribution by category</p><div class="flex justify-center items-center h-[200px]"><canvas id="incidentTypesChart"></canvas></div><div class="flex justify-center gap-4 text-xs mt-4 dark:text-neutral-400"><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-500"></span> Fire</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span> Flood</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-purple-500"></span> Crime</span></div></div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-sm"><h5 class="text-sm font-semibold text-gray-700 dark:text-neutral-300 mb-4">Response Time</h5><div style="height: 180px"><canvas id="responseTimeChart"></canvas></div></div>
        <div class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-sm"><h5 class="text-sm font-semibold text-gray-700 dark:text-neutral-300 mb-4">Peak Hours</h5><div style="height: 180px"><canvas id="peakHoursChart"></canvas></div></div>
      </div>

      <div
        class="bg-white dark:bg-neutral-800 rounded-2xl p-6 shadow-sm"
      >
        <h5 class="text-sm font-semibold text-gray-700 dark:text-neutral-300 mb-4">
            Recent Emergency Incidents
        </h5>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-neutral-700">
                <thead class="bg-gray-50 dark:bg-neutral-700">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wider">INCIDENT ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wider">TYPE</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wider">INCIDENT</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wider">DATE REPORTED</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wider">RESPONSE TIME</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wider">STATUS</th>
                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 dark:text-neutral-400 uppercase tracking-wider">ACTIONS</th>
                    </tr>
                </thead>
                <tbody id="incidentTableBody" class="divide-y divide-gray-200 dark:divide-neutral-700">
                    </tbody>
            </table>
        </div>

        <div class="flex justify-end items-center mt-4">
            <button class="text-gray-500 dark:text-neutral-400 hover:text-gray-700 dark:hover:text-neutral-300 p-2">
                <i class="uil uil-angle-left-b text-lg"></i>
            </button>
            <span class="text-sm text-gray-500 dark:text-neutral-400 mx-2">1 / 5</span>
            <button class="text-gray-500 dark:text-neutral-400 hover:text-gray-700 dark:hover:text-neutral-300 p-2">
                <i class="uil uil-angle-right-b text-lg"></i>
            </button>
        </div>
      </div>
    </div>

    <div id="crudModal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-neutral-800 rounded-xl w-full max-w-lg p-6 shadow-2xl transition-all scale-95 duration-200">
            <div class="flex justify-between items-center border-b pb-3 dark:border-neutral-700">
                <h3 id="modalTitle" class="text-lg font-semibold text-gray-900 dark:text-neutral-200">Add New Incident</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition"><i class="uil uil-times text-xl"></i></button>
            </div>
            <form id="incidentForm" class="mt-4 space-y-4">
                <input type="hidden" id="incidentId">

                <div>
                    <label for="incidentType" class="block text-sm font-medium text-gray-700 dark:text-neutral-400">Type</label>
                    <select id="incidentType" required class="mt-1 block w-full rounded-lg border-gray-300 dark:border-neutral-600 dark:bg-neutral-700 dark:text-neutral-300 focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5">
                        <option value="Fire">Fire</option>
                        <option value="Medical">Medical</option>
                        <option value="Crime">Crime</option>
                        <option value="Flood">Flood</option>
                    </select>
                </div>

                <div>
                    <label for="incidentLocation" class="block text-sm font-medium text-gray-700 dark:text-neutral-400">Location/Description</label>
                    <input type="text" id="incidentLocation" required class="mt-1 block w-full rounded-lg border-gray-300 dark:border-neutral-600 dark:bg-neutral-700 dark:text-neutral-300 focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5">
                </div>
                
                <div>
                    <label for="incidentStatus" class="block text-sm font-medium text-gray-700 dark:text-neutral-400">Status</label>
                    <select id="incidentStatus" required class="mt-1 block w-full rounded-lg border-gray-300 dark:border-neutral-600 dark:bg-neutral-700 dark:text-neutral-300 focus:border-blue-500 focus:ring-blue-500 text-sm p-2.5">
                        <option value="Active">Active</option>
                        <option value="En Route">En Route</option>
                        <option value="Resolved">Resolved</option>
                    </select>
                </div>

                <div class="flex justify-end pt-4 border-t dark:border-neutral-700">
                    <button type="button" id="cancelFormBtn" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-neutral-300 rounded-lg hover:bg-gray-100 dark:hover:bg-neutral-700 transition mr-3">Cancel</button>
                    <button type="submit" id="saveFormBtn" class="px-4 py-2 text-sm font-medium text-white bg-blue-500 rounded-lg hover:bg-blue-600 transition">Save Incident</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toastContainer" class="fixed top-5 right-5 space-y-2 z-[100]">
        </div>
    <script>
        // --- 1. DATA AND STATE MANAGEMENT (UPDATED) ---
        let incidents = [
            // All statuses are now 'Resolved'
            { id: 1, type: 'Fire', location: 'Mckinley Ave, S. Yellow Coat Ctr.', reported: '2023-12-10 2:06 PM', responseTime: '2.4 min', status: 'Resolved' },
            { id: 2, type: 'Medical', location: '123 Main St, Central District', reported: '2023-12-11 9:15 AM', responseTime: '3.1 min', status: 'Resolved' },
            { id: 3, type: 'Crime', location: 'Sylvanian Rd, North End', reported: '2023-12-11 11:30 AM', responseTime: '1.8 min', status: 'Resolved' },
            { id: 4, type: 'Fire', location: 'Austin House, S. Yellow Coat Ctr.', reported: '2023-12-12 1:45 PM', responseTime: '4.0 min', status: 'Resolved' },
        ];
        let nextIncidentId = incidents.length > 0 ? Math.max(...incidents.map(i => i.id)) + 1 : 1;

        // --- 2. UTILITY FUNCTIONS (UNMODIFIED) ---
        
        // Shows a temporary toast notification
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            
            let colorClass, iconClass;
            if (type === 'success') {
                colorClass = 'bg-emerald-500';
                iconClass = 'uil-check-circle';
            } else if (type === 'error') {
                colorClass = 'bg-red-500';
                iconClass = 'uil-times-circle';
            } else {
                colorClass = 'bg-blue-500';
                iconClass = 'uil-info-circle';
            }

            toast.className = `p-4 rounded-lg shadow-lg flex items-center space-x-3 text-white ${colorClass} transition-all duration-300 ease-in-out transform translate-x-full opacity-0`;
            toast.innerHTML = `<i class="uil ${iconClass} text-2xl"></i><span>${message}</span>`;
            
            container.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.classList.add('translate-x-0', 'opacity-100');
            }, 10);
            
            // Animate out and remove
            setTimeout(() => {
                toast.classList.remove('translate-x-0', 'opacity-100');
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        // --- 3. CRUD FUNCTIONS (UNMODIFIED) ---

        // Function to open the modal for adding an incident
        document.getElementById('addIncidentBtn').addEventListener('click', () => {
            document.getElementById('incidentId').value = '';
            document.getElementById('incidentForm').reset();
            document.getElementById('modalTitle').textContent = 'Add New Incident';
            document.getElementById('saveFormBtn').textContent = 'Add Incident';
            document.getElementById('crudModal').classList.remove('hidden');
        });

        // Function to open the modal for editing an incident (Update)
        function editIncident(id) {
            const incident = incidents.find(i => i.id === id);
            if (!incident) return;

            document.getElementById('incidentId').value = incident.id;
            document.getElementById('incidentType').value = incident.type;
            document.getElementById('incidentLocation').value = incident.location;
            document.getElementById('incidentStatus').value = incident.status;
            
            document.getElementById('modalTitle').textContent = `Edit Incident #${incident.id}`;
            document.getElementById('saveFormBtn').textContent = 'Save Changes';
            document.getElementById('crudModal').classList.remove('hidden');
        }

        // Function to handle form submission (Create & Update)
        document.getElementById('incidentForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const id = document.getElementById('incidentId').value;
            const type = document.getElementById('incidentType').value;
            const location = document.getElementById('incidentLocation').value;
            const status = document.getElementById('incidentStatus').value;
            const now = new Date();
            const reported = now.toLocaleDateString() + ' ' + now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            if (id) {
                // Update operation
                const index = incidents.findIndex(i => i.id == id);
                if (index !== -1) {
                    incidents[index] = {
                        ...incidents[index],
                        type,
                        location,
                        status
                    };
                    showToast(`Incident #${id} updated successfully!`);
                }
            } else {
                // Create operation
                const newIncident = {
                    id: nextIncidentId++,
                    type,
                    location,
                    reported,
                    responseTime: 'TBD', // Placeholder for new incident
                    status
                };
                incidents.push(newIncident);
                showToast(`New Incident #${newIncident.id} added!`);
            }

            document.getElementById('crudModal').classList.add('hidden');
            renderIncidents();
        });

        // Function to delete an incident (Delete)
        function deleteIncident(id) {
            if (confirm(`Are you sure you want to delete Incident #${id}?`)) {
                incidents = incidents.filter(i => i.id !== id);
                renderIncidents();
                showToast(`Incident #${id} deleted.`, 'error');
            }
        }

        // --- 4. BUTTON ACTIONS AND GENERAL SETUP (UNMODIFIED) ---

        // Modal close buttons
        document.getElementById('closeModalBtn').addEventListener('click', () => {
            document.getElementById('crudModal').classList.add('hidden');
        });
        document.getElementById('cancelFormBtn').addEventListener('click', () => {
            document.getElementById('crudModal').classList.add('hidden');
        });

        // Top action buttons
        document.getElementById('filterBtn').addEventListener('click', () => {
            showToast('Applying Filter logic (simulated).', 'info');
        });
        document.getElementById('exportBtn').addEventListener('click', () => {
            showToast('Report data exported successfully (simulated).', 'success');
        });

        // Dark Mode Logic
        const themeToggleBtn = document.querySelector('[data-toggle-theme]');
        const currentTheme = localStorage.getItem('theme');

        if (currentTheme) {
            document.documentElement.setAttribute('data-theme', currentTheme);
            if (currentTheme === 'dark') {
                themeToggleBtn.checked = true;
            }
        }

        themeToggleBtn.addEventListener('change', function () {
            if (this.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
            initializeCharts();
        });
        // Initialize on page load
        window.onload = () => {
            renderIncidents(); // Populate the table with the updated data
        };
    </script>

  </body>
</html>